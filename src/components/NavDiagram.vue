<template>
  <div class="nav-container">
    <svg viewBox="8 -10 591.85 417.5">
      <defs>
        <linearGradient
          id="linear-gradient-1"
          x1="185.37"
          y1="231.15"
          x2="410.21"
          y2="231.15"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0.06" stop-color="#09223f" />
          <stop offset="0.22" stop-color="#2e3e5a" />
          <stop offset="0.52" stop-color="#505f79" />
          <stop offset="0.91" stop-color="#8793a9" />
          <stop offset="0.99" stop-color="#7e8fa8" />
        </linearGradient>
        <linearGradient
          id="linear-gradient-2"
          x1="187.23"
          y1="172.65"
          x2="422.12"
          y2="172.65"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0.28" stop-color="#7888a1" />
          <stop offset="0.74" stop-color="#7e8fa8" />
        </linearGradient>
        <linearGradient
          id="linear-gradient-3"
          x1="144.51"
          y1="310.48"
          x2="420.02"
          y2="34.97"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0.36" stop-color="#86c9ed" />
          <stop offset="0.56" stop-color="#e8ae4a" />
        </linearGradient>
        <linearGradient
          id="linear-gradient-4"
          x1="169.26"
          y1="231.36"
          x2="244.59"
          y2="231.36"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0.36" stop-color="#86c9ed" />
          <stop offset="0.59" stop-color="#e8ae4a" />
        </linearGradient>
        <linearGradient
          id="linear-gradient-5"
          x1="307.56"
          y1="349.03"
          x2="307.56"
          y2="22.17"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0.16" stop-color="#86c9ed" />
          <stop offset="0.42" stop-color="#e8ae4a" />
          <stop offset="1" stop-color="#d35b32" />
        </linearGradient>
        <linearGradient
          id="linear-gradient-6"
          x1="310.94"
          y1="232.41"
          x2="310.94"
          y2="113.63"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0.21" stop-color="#c8cfd9" />
          <stop offset="1" stop-color="#8fc0df" />
        </linearGradient>
        <linearGradient
          id="linear-gradient-7"
          x1="380.87"
          y1="81.62"
          x2="398.21"
          y2="81.62"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0.15" stop-color="#e8ad4b" />
          <stop offset="0.9" stop-color="#ce8231" />
        </linearGradient>
        <linearGradient
          id="linear-gradient-8"
          x1="396.3"
          y1="114.59"
          x2="499.25"
          y2="114.59"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0" stop-color="#d35b30" />
          <stop offset="0.04" stop-color="#d6682f" />
          <stop offset="0.11" stop-color="#d9772f" />
          <stop offset="0.2" stop-color="#db7f2e" />
          <stop offset="0.32" stop-color="#dc822e" />
          <stop offset="0.67" stop-color="#e0922f" />
        </linearGradient>

        <filter id="shadow">
          <feDropShadow dx="1.5" dy="1.5" stdDeviation="2" />
        </filter>
      </defs>
      <g>
        <g>
          <rect
            class="bg-outline"
            filter="url(#shadow)"
            x="152.9"
            y="39.76"
            width="79.65"
            height="38.61"
          />
          <path
            class="bg-outline"
            filter="url(#shadow)"
            d="M7.59,388.56a10.34,10.34,0,0,0,10.33,10.33H126.53V373.72H7.59Z"
          />
          <path
            class="bg-outline"
            filter="url(#shadow)"
            d="M493.22,43.33V2.83h-4.88V13.91l-128.68,0c-.72,0-1.44-.08-2.18-.08H17.92a9.28,9.28,0,0,0-1.06.06,10.24,10.24,0,0,0-2,.41c-.32.1-.64.21-.95.34a11,11,0,0,0-1.75,1,10.17,10.17,0,0,0-2.2,2,10.37,10.37,0,0,0-2.36,6.57V370.76H126.53V357.3l110.92,0v41.56h81.66V357.36l143.23,0v2.87H395.05v38.62h81.66V357.41h11.63v11h4.88v-40.5h-4.88V339H476.71V249a8.73,8.73,0,0,1,8.73-8.73h2.9v11.39h4.88v-40.5h-4.88v10.67h-35V141.48H384.83v80.35l-83.29,0V141.48H233v80.3H213.68a8.35,8.35,0,0,1-8-8.33V137.72a14.21,14.21,0,0,1,14.07-14.2l268.6.07v11.25h4.88V94.34h-4.88v10.85l-268.46-.12h-26.6a32.68,32.68,0,0,0-32.65,32.65v84H152.9V39.68a20.15,20.15,0,0,0-1.46-7.43L359,32.32a14.2,14.2,0,0,1,12.71,14.12V89.7h0v15.43h81.82V42.24H389.85a32.38,32.38,0,0,0-2.92-9.91l101.41,0v11ZM179.07,137.72a14.23,14.23,0,0,1,11.27-13.9,32.5,32.5,0,0,0-3.11,13.9v75.72a26.71,26.71,0,0,0,1.33,8.33h-9.49Zm0,102.49h34.24l.71,0h18v0l232.56.08a17.71,17.71,0,0,0-2.29,8.72l.07,89.94h-8.87V258.5H384.93v80.43H360.75V258.5H292.37v80.4H268.64V258.5H199.79v80.29h-6.51a14.23,14.23,0,0,1-14.21-14.21ZM152.9,331.47V240.2h7.73v84.38a32.4,32.4,0,0,0,3.29,14.28h-12.1A25.75,25.75,0,0,0,152.9,331.47Zm-18.45,0a7.27,7.27,0,0,1-4.21,6.6,6.86,6.86,0,0,1-3.71-6.1V239.42a24.81,24.81,0,0,0,6.13.77h1.79Zm0-109.72h-1.79a6.14,6.14,0,0,1-6.13-6.14h0V32.46h.62a7.3,7.3,0,0,1,7.3,7.3Z"
          />

          <path
            class="cls-2"
            d="M205.38,357.23h-12.1a32.68,32.68,0,0,1-32.65-32.65V137.72a32.68,32.68,0,0,1,32.65-32.65l295.06.12v18.4l-295.06-.08a14.23,14.23,0,0,0-14.21,14.21V324.58a14.23,14.23,0,0,0,14.21,14.21h12.1Z"
          />
          <path
            class="cls-3"
            d="M476.71,398.89H462.37L462.25,249a17.78,17.78,0,0,1,17.89-17.8l10.64.06v9h-5.34a8.73,8.73,0,0,0-8.73,8.73Z"
          />
          <path
            class="cls-4"
            d="M108.15,14h14.94c14.17,0,29.81,11.49,29.81,25.66V331.47a25.73,25.73,0,0,1-25.73,25.73h-19V338.76h19a7.28,7.28,0,0,0,7.28-7.29V39.76a7.3,7.3,0,0,0-7.3-7.3h-19Z"
          />
          <path
            class="cls-4"
            d="M476.71,398.89H462.37L462.25,249a17.78,17.78,0,0,1,17.89-17.8l10.64.06v9h-5.34a8.73,8.73,0,0,0-8.73,8.73Z"
          />
          <path
            class="cls-7"
            d="M490.78,357.41l-389.2-.12,25-28.7V332a6.89,6.89,0,0,0,6.88,6.89l357.37.11Z"
          />
          <rect class="cls-4" x="395.05" y="360.27" width="81.66" height="38.61" />
          <rect class="cls-4" x="152.9" y="39.76" width="79.65" height="38.61" />
          <polyline class="cls-11" points="493.22 134.84 488.34 134.84 488.34 94.34 493.22 94.34" />
          <rect class="cls-10" x="488.34" y="327.88" width="4.88" height="40.5" />
          <polygon
            class="cls-12"
            points="488.34 2.83 488.34 13.91 101.58 13.79 101.58 32.24 488.34 32.36 488.34 43.33 493.22 43.33 493.22 2.83 488.34 2.83"
          />
          <path
            class="cls-13"
            d="M390.13,89.7H371.69V46.44a14.21,14.21,0,0,0-14.21-14.2H105.1a6.88,6.88,0,0,0-6.88,6.88v4.65l-22.83-30H357.48a32.65,32.65,0,0,1,32.65,32.65Z"
          />

          <foreignObject x="371.49" y="42.24" width="82.83" height="63.89">
            <div
              class="component mixing-valve"
              :class="status('tempered_supply/mixing_valve')"
              @click="selectItem('mixing_valve')"
            >
              <div v-show="mixingValveSetpoint || mixingValveSetpoint === 0" class="temp">{{ mixingValveSetpoint | tempScale }}°</div>
              <spinner v-show="!mixingValveSetpoint && mixingValveSetpoint != 0" spinnerSize="0 0 65 31" spinnerWidth="65px" :spinnerColor="getColorFromStatus(status('tempered_supply/mixing_valve'))"></spinner>
              <div class="name">
                <span>Mix</span>
                <img class="wrn" src="../../public/assets/alert-warning.png" />
                <img class="err" src="../../public/assets/alert-error.png" />
              </div>
            </div>
          </foreignObject>
          <foreignObject x="384" y="258" width="70" height="81">
            <div
              class="component cold-inlet-filter"
              :class="status('cold_inlet/sediment_filter')"
              @click="selectItem('filter', 'cold_sediment_filter')"
            >
              <img class="wrn" src="../../public/assets/alert-warning.png" />
              <img class="err" src="../../public/assets/alert-error.png" />
              <label>Filter</label>
            </div>
          </foreignObject>
          <foreignObject x="291.87" y="257.98" width="69.38" height="81">
            <div
              class="component anti-scaling"
              :class="status('cold_inlet/anti_scaling')"
              @click="selectItem('anti_scaling')"
            >
              <img class="wrn" src="../../public/assets/alert-warning.png" />
              <img class="err" src="../../public/assets/alert-error.png" />
              <label>
                Anti-
                <br />Scale
              </label>
            </div>
          </foreignObject>
          <foreignObject x="199.27" y="257.98" width="70" height="81">
            <div
              class="component cold-inlet-uv"
              :class="status('cold_inlet/uv_disinfect')"
              @click="selectItem('uv_disinfect', 'cold_uv_disinfect')"
            >
              <img class="wrn" src="../../public/assets/alert-warning.png" />
              <img class="err" src="../../public/assets/alert-error.png" />
              <label>UV</label>
            </div>
          </foreignObject>
          <foreignObject x="384.0" y="140.96" width="69.52" height="81">
            <div
              class="component recirc-inlet-filter"
              :class="status('recirc_inlet/sediment_filter')"
              @click="selectItem('filter', 'recirc_sediment_filter')"
            >
              <img class="wrn" src="../../public/assets/alert-warning.png" />
              <img class="err" src="../../public/assets/alert-error.png" />
              <label>Filter</label>
            </div>
          </foreignObject>
          <foreignObject x="232.3" y="140.96" width="69.52" height="81">
            <div
              class="component recirc-inlet-uv"
              :class="status('recirc_inlet/uv_disinfect')"
              @click="selectItem('uv_disinfect', 'recirc_uv_disinfect')"
            >
              <img class="wrn" src="../../public/assets/alert-warning.png" />
              <img class="err" src="../../public/assets/alert-error.png" />
              <label>UV</label>
            </div>
          </foreignObject>
          <rect
            class="percent-bar recirc"
            x="246.32"
            y="149.26"
            width="42.88"
            height="3.55"
            rx="1.78"
          />
          <rect
            class="percent-bar recirc"
            x="398.12"
            y="149.25"
            width="42.88"
            height="3.55"
            rx="1.78"
          />
          <rect
            class="percent-bar cold-inlet"
            x="397.59"
            y="266.27"
            width="42.88"
            height="3.56"
            rx="1.78"
          />
          <rect
            class="percent-bar cold-inlet"
            x="213.22"
            y="266.27"
            width="42.88"
            height="3.56"
            rx="1.78"
          />
          <rect
            class="percent-bar cold-inlet"
            x="305.59"
            y="266.27"
            width="42.88"
            height="3.56"
            rx="1.78"
          />

          <rect
            fill="white"
            x="246.32"
            y="149.26"
            height="3.55"
            rx="1.78"
            :width="calcPercentWidth(topicMap('company/recirc_inlet/uv_disinfect/percent_remaining/report'))"
          />
          <rect
            fill="white"
            x="398.12"
            y="149.25"
            height="3.55"
            rx="1.78"
            :width="calcPercentWidth(topicMap('company/recirc_inlet/sediment_filter/percent_remaining/report'))"
          />
          <rect
            fill="white"
            x="397.59"
            y="266.27"
            height="3.56"
            rx="1.78"
            :width="calcPercentWidth(topicMap('company/cold_inlet/sediment_filter/percent_remaining/report'))"
          />
          <rect
            fill="white"
            x="213.22"
            y="266.27"
            height="3.56"
            rx="1.78"
            :width="calcPercentWidth(topicMap('company/cold_inlet/uv_disinfect/percent_remaining/report'))"
          />
          <rect
            fill="white"
            x="305.59"
            y="266.27"
            height="3.56"
            rx="1.78"
            :width="calcPercentWidth(topicMap('company/cold_inlet/anti_scaling/percent_remaining/report'))"
          />

          <path
            class="cls-5"
            d="M232,240.24H214a26.83,26.83,0,0,1-26.79-26.8V137.72a32.68,32.68,0,0,1,32.65-32.65l268.46.12v18.32H219.88a14.23,14.23,0,0,0-14.21,14.21v75.72a8.36,8.36,0,0,0,8.35,8.35h18Z"
          />
          <path
            class="cls-8"
            d="M204.13,348.13H192.91a22.69,22.69,0,0,1-22.69-22.7V135.56a21,21,0,0,1,21-21h52.45"
          />
          <path
            class="cls-9"
            d="M488.34,211.19v10.67l-355.68-.11a6.14,6.14,0,0,1-6.13-6.14H108.09a24.58,24.58,0,0,0,24.57,24.58l355.68.11v11.39h4.88v-40.5Z"
          />
          <path
            :class="status('hot_supply/water_heater')"
            @click="selectItem('water_heater')"
            class="component cls-7 water-heater"
            d="M126.53,13.79H17.92A10.34,10.34,0,0,0,7.59,24.12V370.76H126.53Z"
          />
          <path 
            :class="status('hot_supply/water_heater/blowdown')"
            class="component cls-7 blowdown-valve" 
            d="M7.59,373.72v14.84a10.34,10.34,0,0,0,10.33,10.33H126.53V373.72Z" />
          <rect class="cls-7" x="488.34" y="327.88" width="4.88" height="40.5" />

          <rect class="cls-7" x="237.44" y="356.27" width="82.66" height="43.61" />

          <!-- <text transform="translate(45 335)" @click="selectItem('water_heater')">Heater</text> -->
          <text transform="translate(18 391)">Blowdown Valve</text>

          <foreignObject x="35" y="25" width="70" height="70" @click="selectItem('water_heater')">
            <div class="white">
              <div v-show="waterHeaterSetpoint || waterHeaterSetpoint === 0" class="temp center">{{ waterHeaterSetpoint | tempScale }}°</div>
              <spinner v-show="!waterHeaterSetpoint && waterHeaterSetpoint != 0" spinnerSize="0 0 65 31" spinnerWidth="65px" :spinnerColor="getColorFromStatus(status('hot_supply/water_heater'))"></spinner>
              <div class="set-point">Set Point</div>
            </div>
          </foreignObject>
          <foreignObject x="35" y="295" width="70" height="70" @click="selectItem('water_heater')">
            <div class="white">
              <div v-show="topicMap('company/hot_supply/water_heater/outlet_temp/report')" class="temp center">{{ topicMap('company/hot_supply/water_heater/outlet_temp/report') | tempScale }}°</div>
              <spinner v-show="!topicMap('company/hot_supply/water_heater/outlet_temp/report')" spinnerSize="0 0 65 31" spinnerWidth="65px" :spinnerColor="getColorFromStatus(status('hot_supply/water_heater'))"></spinner>
              <div class="set-point">Water Heater</div>
            </div>
          </foreignObject>
          <foreignObject x="153" y="40" width="80" height="40">
            <div class="component sanitation-loop" 
                :class="status('hot_supply/water_heater/sanitation_loop')">
              Sanitation
              <br />Pump
            </div>
          </foreignObject>
          <foreignObject x="237" y="357" width="83" height="43">
            <div class="component booster-pump" :class="status('cold_inlet/booster_pump')">
              Booster
              <br />Pump
            </div>
          </foreignObject>
          <foreignObject x="394" y="360" width="83" height="40">
            <div class="component diverter-object"
                :class="status('recirc_inlet/diverter_valve')"
                @click="selectItem('diverter_valve')">
              Diverter
              <br />Valve
            </div>
          </foreignObject>
          <rect
            class="overlay sanitation-overlay"
            @click="goToView('sanitation', 'sanitation_loop')"
            x="134.8"
            y="40.5"
            width="97.5"
            height="38.61"
          />
          <rect
            class="overlay blowdown-overlay"
            @click="goToView('sanitation', 'blowdown_cycle')"
            x="8"
            y="374"
            width="119"
            height="25.61"
          />
          <rect
            class="overlay booster-overlay"
            @click="selectItem('booster_pump')"
            x="237.85"
            y="360.45"
            width="81.66"
            height="38.61"
          />

          <path class="cls-18" d="M498.3,231.46H132.66a15.83,15.83,0,0,1-15.83-15.83V205.14" />
          <path
            class="cls-19"
            d="M498.3,348.13H132.92A16.1,16.1,0,0,1,116.83,332V39.42a16.34,16.34,0,0,1,16.35-16.34H498.3"
          />
          <path class="cls-20" d="M218,231.46a21,21,0,0,1-21-21V135.56a21,21,0,0,1,21-21H424.9" />
          <path class="cls-21" d="M381.82,48.66v50.5a15.43,15.43,0,0,0,15.44,15.43h0" />
          <path class="cls-18" d="M218,231.46a21,21,0,0,1-21-21V135.56a21,21,0,0,1,21-21H424.9" />
          <path class="cls-22" d="M344,23.08h13.71a24.13,24.13,0,0,1,24.14,24.13V64.4" />
          <path class="cls-23" d="M344,23.08h14.12a23.72,23.72,0,0,1,23.73,23.73V64.4" />
          <path class="cls-24" d="M381.82,48.66v50.5a15.43,15.43,0,0,0,15.44,15.43h0" />
          <line class="cls-25" x1="397.26" y1="114.59" x2="498.3" y2="114.59" />
        </g>
      </g>
      <g>
        <foreignObject x="505" y="-7" width="85" height="70">
          <div class="inlet" @click="onTempClicked('hot_supply')">
            <div v-show="topicMap(formTempTopic('hot_supply'))" class="temp">{{ topicMap(formTempTopic('hot_supply')) | tempScale }}°</div>
            <spinner v-show="!topicMap(formTempTopic('hot_supply'))" spinnerSize="0 0 65 31" spinnerWidth="65px" :spinnerColor="getColorFromStatus(status('tempered_supply/temp_sensor'))"></spinner>
            <div :style="{ opacity: 0.5, color: getColorFromStatus(status('hot_supply/temp_sensor')) }">
              High Temp
              <br />Supply
            </div>
          </div>
        </foreignObject>
        <foreignObject x="505" y="85" width="85" height="70">
          <div class="inlet" @click="onTempClicked('tempered_supply')">
            <div v-show="topicMap(formTempTopic('tempered_supply'))" class="temp">{{ topicMap(formTempTopic('tempered_supply')) | tempScale }}°</div>
            <spinner v-show="!topicMap(formTempTopic('tempered_supply'))" spinnerSize="0 0 65 31" spinnerWidth="65px" :spinnerColor="getColorFromStatus(status('tempered_supply/temp_sensor'))"></spinner>
            <div :style="{ opacity: 0.5, color: getColorFromStatus(status('tempered_supply/temp_sensor')) }">
              Tempered
              <br />Supply
            </div>
          </div>
        </foreignObject>
        <foreignObject x="505" y="202" width="85" height="70">
          <div class="inlet" @click="onTempClicked('recirc_inlet')">
            <div v-show="topicMap(formTempTopic('recirc_inlet'))" class="temp">{{ topicMap(formTempTopic('recirc_inlet')) | tempScale }}°</div>
            <spinner v-show="!topicMap(formTempTopic('recirc_inlet'))" spinnerSize="0 0 65 31" spinnerWidth="65px" :spinnerColor="getColorFromStatus(status('recirc_inlet/temp_sensor'))"></spinner>
            <div :style="{ opacity: 0.5, color: getColorFromStatus(status('recirc_inlet/temp_sensor')) }">
              Recirculation
              <br />Inlet
            </div>
          </div>
        </foreignObject>
        <foreignObject x="505" y="318" width="85" height="70">
          <div class="inlet" @click="onTempClicked('cold_inlet')">
            <div v-show="topicMap(formTempTopic('cold_inlet'))" class="temp">{{ topicMap(formTempTopic('cold_inlet')) | tempScale }}°</div>
            <spinner v-show="!topicMap(formTempTopic('cold_inlet'))" spinnerSize="0 0 65 31" spinnerWidth="65px" :spinnerColor="getColorFromStatus(status('cold_inlet/temp_sensor'))"></spinner>
            <div :style="{ opacity: 0.5, color: getColorFromStatus(status('cold_inlet/temp_sensor')) }">
              Cold Water
              <br />Inlet
            </div>
          </div>
        </foreignObject>
      </g>
      <g id="Frame_01" data-name="Frame 01">
        <polygon
          class="cold-inlet-arrow-1 a1"
          points="498.3 352.63 493.64 348.13 498.3 343.63 498.3 352.63"
        />
        <polygon
          class="cold-inlet-arrow-1 a2"
          points="498.3 352.63 493.64 348.13 498.3 343.63 498.3 352.63"
        />
        <polygon
          class="cold-inlet-arrow-1 a3"
          points="498.3 352.63 493.64 348.13 498.3 343.63 498.3 352.63"
        />
        <polygon
          class="cold-inlet-arrow-2 a1"
          points="196.61 352.65 191.96 348.15 196.61 343.65 196.61 352.65"
        />
        <polygon
          class="cold-inlet-arrow-2 a2"
          points="196.61 352.65 191.96 348.15 196.61 343.65 196.61 352.65"
        />
        <polygon
          class="cold-inlet-arrow-2 a3"
          points="196.61 352.65 191.96 348.15 196.61 343.65 196.61 352.65"
        />
        <polygon
          class="cold-inlet-arrow-3 a1"
          points="165.69 324.37 170.19 319.71 174.69 324.37 165.69 324.37"
        />
        <polygon
          class="cold-inlet-arrow-3 a2"
          points="165.69 324.37 170.19 319.71 174.69 324.37 165.69 324.37"
        />
        <polygon
          class="cold-inlet-arrow-3 a3"
          points="165.69 324.37 170.19 319.71 174.69 324.37 165.69 324.37"
        />
        <polygon
          class="cold-inlet-arrow-4 a1"
          points="165.69 211.93 170.19 207.27 174.69 211.93 165.69 211.93"
        />
        <polygon
          class="cold-inlet-arrow-4 a2"
          points="165.69 211.93 170.19 207.27 174.69 211.93 165.69 211.93"
        />
        <polygon
          class="cold-inlet-arrow-4 a3"
          points="165.69 211.93 170.19 207.27 174.69 211.93 165.69 211.93"
        />

        <polygon
          class="recirc-inlet-arrow-1 a1"
          points="498.3 235.97 493.64 231.47 498.3 226.97 498.3 235.97"
        />
        <polygon
          class="recirc-inlet-arrow-1 a2"
          points="498.3 235.97 493.64 231.47 498.3 226.97 498.3 235.97"
        />
        <polygon
          class="recirc-inlet-arrow-1 a3"
          points="498.3 235.97 493.64 231.47 498.3 226.97 498.3 235.97"
        />
        <polygon
          class="recirc-inlet-arrow-2 a1"
          points="382.36 235.97 377.7 231.47 382.36 226.97 382.36 235.97"
        />
        <polygon
          class="recirc-inlet-arrow-2 a2"
          points="382.36 235.97 377.7 231.47 382.36 226.97 382.36 235.97"
        />
        <polygon
          class="recirc-inlet-arrow-2 a3"
          points="382.36 235.97 377.7 231.47 382.36 226.97 382.36 235.97"
        />
        <polygon
          class="recirc-inlet-arrow-3 a1"
          points="192.44 206.82 196.94 202.16 201.44 206.82 192.44 206.82"
        />
        <polygon
          class="recirc-inlet-arrow-3 a2"
          points="192.44 206.82 196.94 202.16 201.44 206.82 192.44 206.82"
        />
        <polygon
          class="recirc-inlet-arrow-3 a3"
          points="192.44 206.82 196.94 202.16 201.44 206.82 192.44 206.82"
        />
        <polygon
          class="recirc-inlet-arrow-4 a1"
          points="232.55 110.09 237.21 114.59 232.55 119.09 232.55 110.09"
        />
        <polygon
          class="recirc-inlet-arrow-4 a2"
          points="232.55 110.09 237.21 114.59 232.55 119.09 232.55 110.09"
        />
        <polygon
          class="recirc-inlet-arrow-4 a3"
          points="232.55 110.09 237.21 114.59 232.55 119.09 232.55 110.09"
        />

        <polygon
          class="high-supply-arrow-1 a1"
          points="137.9 27.81 142.56 23.32 137.9 18.82 137.9 27.81"
        />
        <polygon
          class="high-supply-arrow-1 a2"
          points="137.9 27.81 142.56 23.32 137.9 18.82 137.9 27.81"
        />
        <polygon
          class="high-supply-arrow-1 a3"
          points="137.9 27.81 142.56 23.32 137.9 18.82 137.9 27.81"
        />
        <polygon
          class="high-supply-arrow-2 a1"
          points="386.7 18.66 391.36 23.16 386.7 27.66 386.7 18.66"
        />
        <polygon
          class="high-supply-arrow-2 a2"
          points="386.7 18.66 391.36 23.16 386.7 27.66 386.7 18.66"
        />
        <polygon
          class="high-supply-arrow-2 a3"
          points="386.7 18.66 391.36 23.16 386.7 27.66 386.7 18.66"
        />

        <polygon
          class="tempered-supply-arrow a1"
          points="451.66 119.09 456.31 114.59 451.66 110.09 451.66 119.09"
        />
        <polygon
          class="tempered-supply-arrow a2"
          points="451.66 119.09 456.31 114.59 451.66 110.09 451.66 119.09"
        />
        <polygon
          class="tempered-supply-arrow a3"
          points="451.66 119.09 456.31 114.59 451.66 110.09 451.66 119.09"
        />
      </g>
    </svg>
    <modal-event-details ref="modalEventDetails"></modal-event-details>
  </div>
</template>

<script>
import { mapActions, mapGetters, mapState } from "vuex";
import Spinner from '../components/Spinner.vue'
import ModalEventDetails from "../components/ModalEventDetails"

export default {
  name: "NavDiagram",
  data() {
    return {
      selectedItem: "",
      radius: 9.5,
      style: "stroke:#27b7e6;",
      percentRemainingHeight: 42.88,
      interval: null,
      animationFrames: [],
      index: 0
    };
  },
  components: {
    Spinner,
    ModalEventDetails
  },
  mounted() {
    this.selectedItem = this.$router.currentRoute.query.id;

    setTimeout(() => {
      this.publishGet("company/cold_inlet/actual_temp/request");
      this.publishGet("company/tempered_supply/actual_temp/request");
      this.publishGet("company/recirc_inlet/actual_temp/request");
      this.publishGet("company/hot_supply/actual_temp/request");

      this.publishGet("company/hot_supply/water_heater/setpoint_temp/request");
      this.publishGet("company/hot_supply/water_heater/outlet_temp/request");
      this.publishGet(
        "company/tempered_supply/mixing_valve/outlet_setpoint_temp/request"
      );

      this.publishGet("company/cold_inlet/status/request");
      this.publishGet("company/tempered_supply/status/request");
      this.publishGet("company/recirc_inlet/status/request");
      this.publishGet("company/hot_supply/status/request");

      this.publishGet("company/cold_inlet/temp_sensor/status/request");
      this.publishGet("company/tempered_supply/temp_sensor/status/request");
      this.publishGet("company/recirc_inlet/temp_sensor/status/request");
      this.publishGet("company/hot_supply/temp_sensor/status/request"); 

      this.publishGet("company/cold_inlet/sediment_filter/status/request");
      this.publishGet("company/cold_inlet/anti_scaling/status/request");
      this.publishGet("company/cold_inlet/uv_disinfect/status/request");
      this.publishGet("company/cold_inlet/booster_pump/status/request");
      this.publishGet("company/recirc_inlet/sediment_filter/status/request");
      this.publishGet("company/recirc_inlet/uv_disinfect/status/request");
      this.publishGet("company/recirc_inlet/diverter_valve/status/request");
      this.publishGet("company/hot_supply/water_heater/status/request");
      this.publishGet("company/hot_supply/water_heater/blowdown/status/request");
      this.publishGet("company/hot_supply/water_heater/sanitation_loop/status/request");
      this.publishGet("company/tempered_supply/mixing_valve/status/request");

      this.publishGet(
        "company/recirc_inlet/uv_disinfect/percent_remaining/request"
      );
      this.publishGet(
        "company/recirc_inlet/sediment_filter/percent_remaining/request"
      );
      this.publishGet(
        "company/cold_inlet/uv_disinfect/percent_remaining/request"
      );
      this.publishGet(
        "company/cold_inlet/sediment_filter/percent_remaining/request"
      );
      this.publishGet(
        "company/cold_inlet/anti_scaling/percent_remaining/request"
      );
    }, 0);
  },
  computed: {
    ...mapGetters(["topicMap", "status", "eventData", "protobufRoot"]),
    ...mapState(["isScrolling"]),
    waterHeaterSetpoint(){
      let s=this.topicMap('company/hot_supply/water_heater/setpoint_temp/report')
      return s
    },
    mixingValveSetpoint(){
      let s=this.topicMap('company/tempered_supply/mixing_valve/outlet_setpoint_temp/report')
      return s
    }
  },
  methods: {
    ...mapActions(["publishGet"]),
    onTempClicked(topic){
      let root = this.protobufRoot
      let s = this.status(topic + '/temp_sensor')

      var c;
      if (topic == "hot_supply"){
        c = root.Component_e.HOT_TEMP_SENSOR
      } else if (topic == "tempered_supply"){
        c = root.Component_e.TEMPERED_TEMP_SENSOR
      } else if (topic == "recirc_inlet"){
        c = root.Component_e.RECIRC_TEMP_SENSOR
      } else { // if (topic == "cold_inlet")
        c = root.Component_e.COLD_TEMP_SENSOR
      }

      if (s === 'error'){
        let data = this.eventData()
        let e = data.filter(x => (x.isOpen && c == root.Component_e[x.component]))
        if (e && e.length > 0){
          this.$refs.modalEventDetails.show(e[0])
        }
      }
    },
    getColorFromStatus: function(state){
      if (state === 'ok') {
        return '#09223F'
      }
      return 'red'
    },
    selectItem(viewName, extendedViewName) {
      let vName = extendedViewName || viewName;
      // Catch unimplemented nav clicks
      if (typeof vName != "string") {
        return;
      }

      if (this.selectedItem !== vName) {
        this.selectedItem = vName;

        let location = {
          name: "details",
          query: { viewName: viewName, extViewName: extendedViewName }
        };

        if (this.$router.currentRoute.name === "details") {
          this.$router.replace(location);
        } else {
          this.$router.push(location);
        }
      }
    },
    goToView(name, view) {
      let location = { name: name, query: { viewName: view } };

      if (this.$router.currentRoute.name === "status") {
        this.$router.push(location);
      } else {
        this.$router.replace(location);
      }
    },
    formTempTopic: function(device) {
      return `company/${device}/actual_temp/report`;
    },
    calcPercentWidth(percent) {
      if (this.$options.filters.isNumeric(percent)) {
        return (percent / 100) * this.percentRemainingHeight;
      }
      return 0;
    }
  },
  beforeDestroy() {
    clearInterval(this.interval);
  }
};
</script>

<style scoped lang="scss">
.nav-container {
  padding-left: 50px;
}
.inlet,
text {
  fill: $white;
  font-size: 14px;
}
.temp {
  font-size: 27px;
  font-family: "HelveticaNeueLTStd-Md";
}
.temp.center {
  text-align:center;
}
.set-point {
  font-size: 11px;
  text-align:center;
}
.inlet {
  color: $deep-blue;
  fill: #4a6a8d;
}
.component {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  height: 100%;
  color: $white;
  font-size: 14px;
  flex-direction: column;
}
.component.recirc {
  background-color: #566a8a;
}
.component.cold-inlet {
  background-color: $deep-blue;
}
.component.cold-inlet-filter {
  background-color: $deep-blue;
}
.component.recirc-inlet-filter {
  background-color: #3c577b;
}
.component.cold-inlet-uv {
  background-color: $deep-blue;
}
.component.recirc-inlet-uv {
  background-color: #3c577b;
}
.component.anti-scaling {
  background-color: $deep-blue;
}
.component img {
  width: 21px;
  height: 19px;
}
.component > label {
  position: absolute;
  bottom: 5px;
  line-height: 12px;
}
.component.ok img {
  display: none;
}
.component.warning img.wrn .component.error img.err {
  display: block;
}
.component.warning img.err {
  display: none;
}
.component.error img.wrn {
  display: none;
}
.component.warning,
.component.error {
  color: black !important;
}
.component.sanitation-loop{
  color: $deep-blue;
}
.component.diverter-object{
  color: $deep-blue;
}
.mixing-valve {
  background-color: #7e8fa8;
  align-items: start;
  padding-left: 20px;
  color: $deep-blue;
}
.mixing-valve > .name {
  width: 60px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.mixing-valve > .temp {
  font-size: 24px;
  line-height: 1.2;
}
/* .selected-item {
    stroke-width: 18;
    transition: stroke-width 0.25s ease-out;
  }
  .unselected-item {
    stroke-width: 0;
    transition: stroke-width 0.25s ease-out;
  } */
.white {
  color: $white;
}
.darkblue {
  color: #09223f;
}
.warning {
  fill: $mustard !important;
  background-color: $mustard !important;
}
.error {
  fill: $red !important;
  background-color: $red !important;
}
.percent_full {
  fill: #fff;
}
.cls-1,
.cls-18,
.cls-19,
.cls-20,
.cls-21,
.cls-22,
.cls-23,
.cls-24,
.cls-25,
.cls-6,
.cls-8 {
  fill: none;
}

.cls-2 {
  fill: url(#linear-gradient-1);
}
.cls-3 {
  fill: #d3d9df;
}
.cls-4 {
  fill: #bcc6d4;
}
.cls-5 {
  fill: url(#linear-gradient-2);
}
.cls-18,
.cls-19,
.cls-20,
.cls-21,
.cls-22,
.cls-23,
.cls-24,
.cls-25,
.cls-6,
.cls-8 {
  stroke-linecap: round;
}
.cls-15,
.cls-17,
.cls-18,
.cls-20,
.cls-21,
.cls-22,
.cls-23,
.cls-24,
.cls-25,
.cls-6,
.cls-8 {
  stroke-miterlimit: 10;
}
.cls-18,
.cls-20,
.cls-21,
.cls-22,
.cls-23,
.cls-24,
.cls-25,
.cls-6,
.cls-8 {
  stroke-width: 1.91px;
}
.cls-6 {
  stroke: url(#linear-gradient-3);
}
.cls-17,
.cls-7 {
  fill: #09223f;
}
.cls-8 {
  stroke: url(#linear-gradient-4);
}
.cls-9 {
  fill: #7888a1;
}
.cls-10 {
  fill: #1b2940;
}

.cls-11 {
  fill: #7e8fa8;
}
.cls-12,
.cls-13 {
  fill: #bdc7d5;
}
.cls-12 {
  opacity: 0.8;
}
.cls-14,
.cls-15 {
  fill: #566a8a;
}
.cls-15,
.cls-17 {
  stroke: #fff;
}
.cls-16 {
  fill: #fff;
}
.cls-18 {
  stroke: #e8ae4a;
}
.cls-19 {
  stroke-linejoin: round;
  stroke-width: 1.8px;
  stroke: url(#linear-gradient-5);
}
.cls-20 {
  stroke: url(#linear-gradient-6);
}
.cls-21 {
  stroke: url(#linear-gradient-7);
}
.cls-22 {
  stroke: #e8ad4b;
}
.cls-23 {
  stroke: #d35b32;
}
.cls-24 {
  stroke: #d35b30;
}
.cls-25 {
  stroke: url(#linear-gradient-8);
}
.bg-outline {
  fill: #0e2e4e;
  opacity: 0.4;
}
.percent-bar {
  stroke-width: 1;
  stroke: $white;
}
.recirc.percent-bar {
  fill: #566a8a;
}
.cold-inlet.percent-bar {
  fill: #09223f;
}
.overlay {
  fill: transparent;
}
@keyframes left-anim {
  0% {
    opacity: 0;
  }
  5% {
    opacity: 1;
  }
  25% {
    opacity: 1;
  }
  30% {
    transform: translateX(-70px);
    opacity: 0;
  }
  100% {
    transform: translateX(-70px);
    opacity: 0;
  }
}
.cold-arrow {
  animation: left-anim 5s linear infinite;
}
.recirc-arrow {
  animation: left-anim 5s 2.3s linear infinite;
}
/*
    Arrow Colors
  */
.cold-inlet-arrow-1 {
  fill: #86c9ed;
  opacity: 0;
}
.cold-inlet-arrow-2 {
  fill: #86c9ed;
  opacity: 0;
}
.cold-inlet-arrow-3 {
  fill: #86c9ed;
  opacity: 0;
}
.cold-inlet-arrow-4 {
  fill: #86c9ed;
  opacity: 0;
}
.recirc-inlet-arrow-1 {
  fill: #e8ae4a;
  opacity: 0;
}
.recirc-inlet-arrow-2 {
  fill: #e8ae4a;
  opacity: 0;
}
.recirc-inlet-arrow-3 {
  fill: #e8ae4a;
  opacity: 0;
}
.recirc-inlet-arrow-4 {
  fill: #e8ae4a;
  opacity: 0;
}
.high-supply-arrow-1 {
  fill: #c34c2c;
  opacity: 0;
}
.high-supply-arrow-2 {
  fill: #c34c2c;
  opacity: 0;
}
.tempered-supply-arrow {
  fill: #fbb040;
  opacity: 0;
}
/*
    Arrow Animations
  */
@keyframes cold-inlet-arrow-1-anim {
  0% {
    opacity: 0;
  }
  5% {
    opacity: 1;
  }
  13% {
    opacity: 1;
  }
  15% {
    transform: translateX(-46px);
    opacity: 0;
  }
  100% {
    transform: translateX(-46px);
    opacity: 0;
  }
}

@keyframes cold-inlet-arrow-2-anim {
  0% {
    opacity: 0;
  }
  5% {
    opacity: 1;
  }
  22% {
    opacity: 1;
  }
  25% {
    transform: translateX(-68px);
    opacity: 0;
  }
  100% {
    transform: translateX(-68px);
    opacity: 0;
  }
}

@keyframes cold-inlet-arrow-3-anim {
  0% {
    opacity: 0;
  }
  5% {
    opacity: 1;
  }
  22% {
    opacity: 1;
  }
  25% {
    transform: translateY(-79px);
    opacity: 0;
  }
  100% {
    transform: translateY(-79px);
    opacity: 0;
  }
}

@keyframes cold-inlet-arrow-4-anim {
  0% {
    opacity: 0;
  }
  5% {
    opacity: 1;
  }
  22% {
    opacity: 1;
  }
  25% {
    transform: translateY(-65px);
    opacity: 0;
  }
  100% {
    transform: translateY(-65px);
    opacity: 0;
  }
}
@keyframes recirc-inlet-arrow-1-anim {
  0% {
    opacity: 0;
  }
  5% {
    opacity: 1;
  }
  23% {
    opacity: 1;
  }
  28% {
    transform: translateX(-46px);
    opacity: 0;
  }
  100% {
    transform: translateX(-46px);
    opacity: 0;
  }
}

@keyframes recirc-inlet-arrow-2-anim {
  0% {
    opacity: 0;
    transform: translateX(-20px);
  }
  5% {
    opacity: 1;
  }
  33% {
    opacity: 1;
  }
  35% {
    transform: translateX(-81px);
    opacity: 0;
  }
  100% {
    transform: translateX(-81px);
    opacity: 0;
  }
}

@keyframes recirc-inlet-arrow-3-anim {
  0% {
    opacity: 0;
  }
  5% {
    opacity: 1;
  }
  25% {
    opacity: 1;
  }
  32% {
    transform: translateY(-65px);
    opacity: 0;
  }
  100% {
    transform: translateY(-65px);
    opacity: 0;
  }
}

@keyframes recirc-inlet-arrow-4-anim {
  0% {
    opacity: 0;
    transform: translateX(20px);
  }
  5% {
    opacity: 1;
  }
  35% {
    opacity: 1;
  }
  40% {
    transform: translateX(110px);
    opacity: 0;
  }
  100% {
    transform: translateX(110px);
    opacity: 0;
  }
}

@keyframes tempered-supply-arrow-anim {
  0% {
    opacity: 0;
    transform: translateX(-35px);
  }
  5% {
    opacity: 1;
  }
  25% {
    opacity: 1;
  }
  32% {
    transform: translateX(47px);
    opacity: 0;
  }
  100% {
    transform: translateX(47px);
    opacity: 0;
  }
}

@keyframes high-supply-arrow-1-anim {
  0% {
    opacity: 0;
    transform: translateX(50px);
  }
  5% {
    opacity: 1;
  }
  35% {
    opacity: 1;
  }
  40% {
    transform: translateX(155px);
    opacity: 0;
  }
  100% {
    transform: translateX(155px);
    opacity: 0;
  }
}
@keyframes high-supply-arrow-2-anim {
  0% {
    opacity: 0;
  }
  5% {
    opacity: 1;
  }
  35% {
    opacity: 1;
  }
  40% {
    transform: translateX(111px);
    opacity: 0;
  }
  100% {
    transform: translateX(111px);
    opacity: 0;
  }
}

.cold-inlet-arrow-1.a1 {
  animation: cold-inlet-arrow-1-anim 6s linear infinite;
}
.cold-inlet-arrow-1.a2 {
  animation: cold-inlet-arrow-1-anim 6s 0.25s linear infinite;
}
.cold-inlet-arrow-1.a3 {
  animation: cold-inlet-arrow-1-anim 6s 0.5s linear infinite;
}
.cold-inlet-arrow-2.a1 {
  animation: cold-inlet-arrow-2-anim 6s 3s linear infinite;
}
.cold-inlet-arrow-2.a2 {
  animation: cold-inlet-arrow-2-anim 6s 3.25s linear infinite;
}
.cold-inlet-arrow-2.a3 {
  animation: cold-inlet-arrow-2-anim 6s 3.5s linear infinite;
}
.cold-inlet-arrow-3.a1 {
  animation: cold-inlet-arrow-3-anim 6s linear infinite;
}
.cold-inlet-arrow-3.a2 {
  animation: cold-inlet-arrow-3-anim 6s 0.25s linear infinite;
}
.cold-inlet-arrow-3.a3 {
  animation: cold-inlet-arrow-3-anim 6s 0.5s linear infinite;
}
.cold-inlet-arrow-4.a1 {
  animation: cold-inlet-arrow-4-anim 6s 3s linear infinite;
}
.cold-inlet-arrow-4.a2 {
  animation: cold-inlet-arrow-4-anim 6s 3.25s linear infinite;
}
.cold-inlet-arrow-4.a3 {
  animation: cold-inlet-arrow-4-anim 6s 3.5s linear infinite;
}
.recirc-inlet-arrow-1.a1 {
  animation: recirc-inlet-arrow-1-anim 3s linear infinite;
}
.recirc-inlet-arrow-1.a2 {
  animation: recirc-inlet-arrow-1-anim 3s 0.25s linear infinite;
}
.recirc-inlet-arrow-1.a3 {
  animation: recirc-inlet-arrow-1-anim 3s 0.5s linear infinite;
}
.recirc-inlet-arrow-2.a1 {
  animation: recirc-inlet-arrow-2-anim 3s 1.5s linear infinite;
}
.recirc-inlet-arrow-2.a2 {
  animation: recirc-inlet-arrow-2-anim 3s 1.7s linear infinite;
}
.recirc-inlet-arrow-2.a3 {
  animation: recirc-inlet-arrow-2-anim 3s 1.9s linear infinite;
}
.recirc-inlet-arrow-3.a1 {
  animation: recirc-inlet-arrow-3-anim 3s linear infinite;
}
.recirc-inlet-arrow-3.a2 {
  animation: recirc-inlet-arrow-3-anim 3s 0.15s linear infinite;
}
.recirc-inlet-arrow-3.a3 {
  animation: recirc-inlet-arrow-3-anim 3s 0.3s linear infinite;
}
.recirc-inlet-arrow-4.a1 {
  animation: recirc-inlet-arrow-4-anim 3s 1.5s linear infinite;
}
.recirc-inlet-arrow-4.a2 {
  animation: recirc-inlet-arrow-4-anim 3s 1.65s linear infinite;
}
.recirc-inlet-arrow-4.a3 {
  animation: recirc-inlet-arrow-4-anim 3s 1.8s linear infinite;
}
.tempered-supply-arrow.a1 {
  animation: tempered-supply-arrow-anim 3s 1.5s linear infinite;
}
.tempered-supply-arrow.a2 {
  animation: tempered-supply-arrow-anim 3s 1.62s linear infinite;
}
.tempered-supply-arrow.a3 {
  animation: tempered-supply-arrow-anim 3s 1.74s linear infinite;
}
.high-supply-arrow-1.a1 {
  animation: high-supply-arrow-1-anim 3s linear infinite;
}
.high-supply-arrow-1.a2 {
  animation: high-supply-arrow-1-anim 3s 0.12s linear infinite;
}
.high-supply-arrow-1.a3 {
  animation: high-supply-arrow-1-anim 3s 0.24s linear infinite;
}
.high-supply-arrow-2.a1 {
  animation: high-supply-arrow-2-anim 3s 1.5s linear infinite;
}
.high-supply-arrow-2.a2 {
  animation: high-supply-arrow-2-anim 3s 1.62s linear infinite;
}
.high-supply-arrow-2.a3 {
  animation: high-supply-arrow-2-anim 3s 1.74s linear infinite;
}
.outlines {
  fill: none;
  stroke: #7d2b8b;
  stroke-miterlimit: 10;
}
.paused {
  animation-play-state: paused !important;
}
</style>
